{% extends "skeleton.html" %}
{% load static %}

{% block content %}
    <div class="container">
        {% if messages %}
            {% for message in messages %}

                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"
                            aria-hidden="true" onclick="closeMessage()"></button>
                    {{ message }}
                </div>

            {% endfor %}
        {% endif %}
    </div>

    <div class="forms_block">
        <br>
        <form action="" id="search_form">
            <fieldset>
                <div class="form-fieldset-one-row">
                    <label for="date_id">Deň:
                        <input type="date" id="date_id" name="date" value="{{ search_params.date|date:"Y-m-d" }}"
                               required>
                    </label>

                    <label for="classroom_id">Učebňa:
                        <input list="classroom" name="classroom" id="classroom_id" value="{{ search_params.room }}">
                    </label>

                    <datalist id="classroom">
                        {% for room in classrooms %}
                            <option value={{ room.id }}>{{ room.name }}</option>
                        {% endfor %}
                    </datalist>
                    <label for="lesson_id">Hodina
                        <input type="number" id="lesson_id" name="lesson" min="0" max="8"
                               value="{{ search_params.lesson }}">
                    </label>
                </div>
            </fieldset>


            <br>
            <fieldset id="equipment_id">
                <div class="form-fieldset-one-row">
                    <label class="form-control">
                        <input type="checkbox" id="interactive_board" name="interactive_board" value="1"
                               {% if search_params.equipment_params.interactive_board %}checked {% endif %}/>
                        Interactive board</label>

                    <label class="form-control">
                        <input type="checkbox" id="data_projector" name="data_projector" value="1"
                               {% if search_params.equipment_params.data_projector %}checked {% endif %}/>
                        Data projector</label>

                    <label class="form-control">
                        <input type="checkbox" id="ethernet_cable" name="ethernet_cable" value="1"
                               {% if search_params.equipment_params.ethernet_cable %}checked {% endif %}/>
                        Internetový kábel</label>
                    <label class="form-control">
                        <input type="checkbox" id="sink" name="sink" value="1"
                               {% if search_params.equipment_params.sink %}checked {% endif %}/>
                        Umývadlo</label>
                    <label class="form-control">
                        <input type="checkbox" id="flip_chart" name="flip_chart" value="1"
                               {% if search_params.equipment_params.flip_chart %}checked {% endif %}/>
                        Flip chart</label>
                    <label class="form-control">
                        <input type="checkbox" id="teacher_notebook" name="teacher_notebook" value="1"
                               {% if search_params.equipment_params.teacher_notebook %}checked {% endif %}/>
                        Učiteľský notebook</label>
                    <label class="form-control">
                        <input type="checkbox" id="teacher_pc" name="teacher_pc" value="1"
                               {% if search_params.equipment_params.teacher_pc %}checked {% endif %}/>
                        Učiteľský počítač</label>
                </div>
            </fieldset>
            <br>
            <input type="submit" id="formSubmit" value="Hľadať" class="submit-button">
        </form>
        <br>
    </div>
    {% if with_results %}
        {% if result_type == "classroom_list" %}
            {% for key, value in result.items %}
                {% if value.occupancy %}
                    <div class="container_taken">
                        <table style="width:100%">
                            <tr>
                                <td>{{ value.info.name }}</td>
                                <td>{{ value.occupancy.0.students }}</td>
                                <td>{{ value.occupancy.0.teacher }}</td>
                                <td>{{ value.occupancy.0.subject }}</td>
                            </tr>
                        </table>
                        <p class="equipment"> Vybavenie:
                            {% for key, value in value.info.equipment.items %}
                                {% if value %}
                                    {{ key }}
                                {% endif %}
                            {% endfor %}
                        </p>
                    </div>
                {% else %}
                    <div class="container_free">
                        <table style="width:100%">
                            <tr>
                                <td>{{ value.info.name }}</td>
                            </tr>
                        </table>
                        <div class="equipment"> Vybavenie:
                            {% for key, value in value.info.equipment.items %}
                                {% if value %}
                                    {{ key }}
                                {% endif %}
                            {% endfor %}
                        </div>
                        <a href="/reservations/create/?date={{ search_params.date|date:"Y-m-d" }}&classroom={{ value.info.id }}&lesson={{ search_params.lesson }}">Rezervácia</a>
                    </div>
                {% endif %}
            {% endfor %}
        {% elif result_type == "lesson_list" %}
            <div class="name_of_classroom">{{ search_room.name }}</div>
            <div class="equipment"> Vybavenie:
                            {% for key, value in search_room.equipment.items %}
                                {% if value %}
                                    {{ key }}
                                {% endif %}
                            {% endfor %}
            </div>
            {% for key, value in result.items %}
                {% if value.occupancy %}
                    <div class="container_taken">
                        <div class="classroom_hours">
                            <table>
                                <tr>
                                    <td>{{ key }}.hodina</td>
                                    <td>{{ value.occupancy.0.students }}</td>
                                    <td>{{ value.occupancy.0.teacher }}</td>
                                    <td>{{ value.occupancy.0.subject }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                {% else %}
                    <div class="container_free">
                        <table style="width:100%">
                            <tr>
                                <td>{{ key }}.hodina</td>
                            </tr>
                        </table>
                        <a href="/reservations/create/?date={{ search_params.date|date:"Y-m-d" }}&classroom={{ search_params.room }}&lesson={{ key }}">Rezervácia</a>
                    </div>
                {% endif %}
            {% endfor %}
        {% elif result_type == "boolean_result" %}
            <div class="name_of_classroom">
                {{ search_room.name }}
                {% if is_free %}
                    - Voľná
                    <a href="/reservations/create/?date={{ search_params.date|date:"Y-m-d" }}&classroom={{ search_params.room }}&lesson={{ search_params.lesson }}">Rezervácia</a>
                {% else %}
                     - Obsadená
                    </div>
                    {% for res in result %}
                        <div class="container_taken">
                            <table style="width:100%">
                                <tr>
                                    <td>{{ res.lesson }}.hodina</td>
                                    <td>{{ res.students }}</td>
                                    <td>{{ res.teacher }}</td>
                                    <td>{{ res.subject }}</td>
                                </tr>
                            </table>
                            <p class="equipment"> Vybavenie:
                                {% for key, value in search_room.equipment.items %}
                                    {% if value %}
                                        {{ key }}
                                    {% endif %}
                                {% endfor %}
                            </p>
                        </div>
                    {% endfor %}
                {% endif %}
        {% endif %}
    {% else %}
        <!--
        tu nechat volne miesto, to ked pouzivatel ide hladat a nema este ziadne vysledky
        -->
    {% endif %}

    <script src="{% static 'js/form_handler.js' %}"></script>
{% endblock %}